<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Module: Compass::Magick::Functions::Operations</title>
<link rel="stylesheet" href="../../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../../_index.html">Index (O)</a> &raquo; 
    <span class='title'>Compass</span> &raquo; <span class='title'><span class='object_link'><a href="../../Magick.html" title="Compass::Magick (module)">Magick</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Functions.html" title="Compass::Magick::Functions (module)">Functions</a></span></span>
     &raquo; 
    <span class="title">Operations</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: Compass::Magick::Functions::Operations
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1">Included in:</dt>
    <dd class="r1"><span class='object_link'><a href="../Functions.html" title="Compass::Magick::Functions (module)">Compass::Magick::Functions</a></span></dd>
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/magick/functions/operations.rb<span class="defines">,<br />
  lib/magick/functions/operations/effects.rb</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Methods for operating on a <span class='object_link'><a href="../Canvas.html" title="Compass::Magick::Canvas (class)">Canvas</a></span>, e.g., crop, compose,
etc.
</p>


  </div>
</div>
<div class="tags">
  
</div><h2>Defined Under Namespace</h2>
<p class="children">
   
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Operations/Effects.html" title="Compass::Magick::Functions::Operations::Effects (module)">Effects</a></span>
    
   
    
  
</p>



  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#magick_compose-instance_method" title="#magick_compose (instance method)">- (Command) <strong>magick_compose</strong>(overlay, x = nil, y = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Composes one <span class='object_link'><a href="Canvas.html" title="Compass::Magick::Functions::Canvas (module)">Canvas</a></span> on top of another.
</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="magick_compose-instance_method">
  
    - (<tt><span class='object_link'><a href="../Command.html" title="Compass::Magick::Command (class)">Command</a></span></tt>) <strong>magick_compose</strong>(overlay, x = nil, y = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Composes one <span class='object_link'><a href="Canvas.html" title="Compass::Magick::Functions::Canvas (module)">Canvas</a></span> on top of another.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="Canvas.html" title="Compass::Magick::Functions::Canvas (module)">Canvas</a></span></tt>)</span>
      
      
        <span class='name'>overlay</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The Canvas object to compose.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>x</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
The left coordinate of the composition operation.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>y</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
The top coordinate of the composition operation.
</p>
</div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../Command.html" title="Compass::Magick::Command (class)">Command</a></span></tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>
A command which composes the two canvas objects together.
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/magick/functions/operations.rb', line 15</span>

<span class='def def kw'>def</span> <span class='magick_compose identifier id'>magick_compose</span><span class='lparen token'>(</span><span class='overlay identifier id'>overlay</span><span class='comma token'>,</span> <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='assert_type identifier id'>assert_type</span> <span class='string val'>'overlay'</span><span class='comma token'>,</span> <span class='overlay identifier id'>overlay</span><span class='comma token'>,</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Canvas constant id'>Canvas</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='assert_type identifier id'>assert_type</span> <span class='string val'>'x'</span><span class='comma token'>,</span> <span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='Sass constant id'>Sass</span><span class='colon2 op'>::</span><span class='Script constant id'>Script</span><span class='colon2 op'>::</span><span class='Number constant id'>Number</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='assert_type identifier id'>assert_type</span> <span class='string val'>'y'</span><span class='comma token'>,</span> <span class='y identifier id'>y</span><span class='comma token'>,</span> <span class='Sass constant id'>Sass</span><span class='colon2 op'>::</span><span class='Script constant id'>Script</span><span class='colon2 op'>::</span><span class='Number constant id'>Number</span>
        <span class='Command constant id'>Command</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='canvas identifier id'>canvas</span><span class='bitor op'>|</span>
          <span class='canvas_x identifier id'>canvas_x</span> <span class='assign token'>=</span> <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='value_of identifier id'>value_of</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span>  <span class='minus op'>-</span> <span class='overlay identifier id'>overlay</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='comma token'>,</span>  <span class='integer val'>0</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
          <span class='canvas_y identifier id'>canvas_y</span> <span class='assign token'>=</span> <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='value_of identifier id'>value_of</span><span class='lparen token'>(</span><span class='y identifier id'>y</span><span class='comma token'>,</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='minus op'>-</span> <span class='overlay identifier id'>overlay</span><span class='dot token'>.</span><span class='height identifier id'>height</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
          <span class='raise identifier id'>raise</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='OutOfBounds constant id'>OutOfBounds</span><span class='comma token'>,</span> <span class='string val'>'Canvas image width is too small to compose overlay'</span>  <span class='if if_mod kw'>if</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span>  <span class='lt op'>&lt;</span> <span class='overlay identifier id'>overlay</span><span class='dot token'>.</span><span class='width identifier id'>width</span>  <span class='plus op'>+</span> <span class='canvas_x identifier id'>canvas_x</span>
          <span class='raise identifier id'>raise</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='OutOfBounds constant id'>OutOfBounds</span><span class='comma token'>,</span> <span class='string val'>'Canvas image height is too small to compose overlay'</span> <span class='if if_mod kw'>if</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='lt op'>&lt;</span> <span class='overlay identifier id'>overlay</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='plus op'>+</span> <span class='canvas_y identifier id'>canvas_y</span>
          <span class='for for kw'>for</span> <span class='y identifier id'>y</span> <span class='in in kw'>in</span> <span class='integer val'>0</span><span class='dot3 op'>...</span><span class='overlay identifier id'>overlay</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='do do kw'>do</span>
            <span class='for for kw'>for</span> <span class='x identifier id'>x</span> <span class='in in kw'>in</span> <span class='integer val'>0</span><span class='dot3 op'>...</span><span class='overlay identifier id'>overlay</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='do do kw'>do</span>
              <span class='overlay_pixel identifier id'>overlay_pixel</span> <span class='assign token'>=</span> <span class='overlay identifier id'>overlay</span><span class='dot token'>.</span><span class='get_pixel identifier id'>get_pixel</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='y identifier id'>y</span><span class='rparen token'>)</span>
              <span class='canvas_pixel identifier id'>canvas_pixel</span>  <span class='assign token'>=</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='get_pixel identifier id'>get_pixel</span><span class='lparen token'>(</span><span class='x identifier id'>x</span> <span class='plus op'>+</span> <span class='canvas_x identifier id'>canvas_x</span><span class='comma token'>,</span> <span class='y identifier id'>y</span> <span class='plus op'>+</span> <span class='canvas_y identifier id'>canvas_y</span><span class='rparen token'>)</span>
              <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='set_pixel identifier id'>set_pixel</span><span class='lparen token'>(</span><span class='x identifier id'>x</span> <span class='plus op'>+</span> <span class='canvas_x identifier id'>canvas_x</span><span class='comma token'>,</span> <span class='y identifier id'>y</span> <span class='plus op'>+</span> <span class='canvas_y identifier id'>canvas_y</span><span class='comma token'>,</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='compose_precise identifier id'>compose_precise</span><span class='lparen token'>(</span><span class='overlay_pixel identifier id'>overlay_pixel</span><span class='comma token'>,</span> <span class='canvas_pixel identifier id'>canvas_pixel</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
            <span class='end end kw'>end</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Crops the {Canvas} to the given region.</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @param [Integer] x1 The left coordinate of the crop operation.</span>
      <span class='comment val'># @param [Integer] y1 The top coordinate of the crop operation.</span>
      <span class='comment val'># @param [Integer] x2 The right coordinate of the crop operation.</span>
      <span class='comment val'># @param [Integer] y2 The bottom coordinate of the crop operation.</span>
      <span class='comment val'># @return {Command} A command which applies the crop to the canvas.</span>
      <span class='def def kw'>def</span> <span class='magick_crop identifier id'>magick_crop</span><span class='lparen token'>(</span><span class='x1 identifier id'>x1</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='y1 identifier id'>y1</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='x2 identifier id'>x2</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='y2 identifier id'>y2</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='assert_type identifier id'>assert_type</span> <span class='string val'>'x1'</span><span class='comma token'>,</span> <span class='x1 identifier id'>x1</span><span class='comma token'>,</span> <span class='Sass constant id'>Sass</span><span class='colon2 op'>::</span><span class='Script constant id'>Script</span><span class='colon2 op'>::</span><span class='Number constant id'>Number</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='assert_type identifier id'>assert_type</span> <span class='string val'>'y1'</span><span class='comma token'>,</span> <span class='y1 identifier id'>y1</span><span class='comma token'>,</span> <span class='Sass constant id'>Sass</span><span class='colon2 op'>::</span><span class='Script constant id'>Script</span><span class='colon2 op'>::</span><span class='Number constant id'>Number</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='assert_type identifier id'>assert_type</span> <span class='string val'>'x2'</span><span class='comma token'>,</span> <span class='x2 identifier id'>x2</span><span class='comma token'>,</span> <span class='Sass constant id'>Sass</span><span class='colon2 op'>::</span><span class='Script constant id'>Script</span><span class='colon2 op'>::</span><span class='Number constant id'>Number</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='assert_type identifier id'>assert_type</span> <span class='string val'>'y2'</span><span class='comma token'>,</span> <span class='y2 identifier id'>y2</span><span class='comma token'>,</span> <span class='Sass constant id'>Sass</span><span class='colon2 op'>::</span><span class='Script constant id'>Script</span><span class='colon2 op'>::</span><span class='Number constant id'>Number</span>
        <span class='Command constant id'>Command</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='canvas identifier id'>canvas</span><span class='bitor op'>|</span>
          <span class='canvas_x1 identifier id'>canvas_x1</span> <span class='assign token'>=</span> <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='value_of identifier id'>value_of</span><span class='lparen token'>(</span><span class='x1 identifier id'>x1</span><span class='comma token'>,</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='comma token'>,</span>  <span class='integer val'>0</span><span class='rparen token'>)</span>
          <span class='canvas_y1 identifier id'>canvas_y1</span> <span class='assign token'>=</span> <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='value_of identifier id'>value_of</span><span class='lparen token'>(</span><span class='y1 identifier id'>y1</span><span class='comma token'>,</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='height identifier id'>height</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
          <span class='canvas_x2 identifier id'>canvas_x2</span> <span class='assign token'>=</span> <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='value_of identifier id'>value_of</span><span class='lparen token'>(</span><span class='x2 identifier id'>x2</span><span class='comma token'>,</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='comma token'>,</span>  <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='rparen token'>)</span>
          <span class='canvas_y2 identifier id'>canvas_y2</span> <span class='assign token'>=</span> <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='value_of identifier id'>value_of</span><span class='lparen token'>(</span><span class='y2 identifier id'>y2</span><span class='comma token'>,</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='height identifier id'>height</span><span class='comma token'>,</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='height identifier id'>height</span><span class='rparen token'>)</span>
          <span class='canvas_x1 identifier id'>canvas_x1</span><span class='comma token'>,</span> <span class='canvas_x2 identifier id'>canvas_x2</span> <span class='assign token'>=</span> <span class='canvas_x2 identifier id'>canvas_x2</span><span class='comma token'>,</span> <span class='canvas_x1 identifier id'>canvas_x1</span> <span class='if if_mod kw'>if</span> <span class='canvas_x1 identifier id'>canvas_x1</span> <span class='gt op'>&gt;</span> <span class='canvas_x2 identifier id'>canvas_x2</span>
          <span class='canvas_y1 identifier id'>canvas_y1</span><span class='comma token'>,</span> <span class='canvas_y2 identifier id'>canvas_y2</span> <span class='assign token'>=</span> <span class='canvas_y2 identifier id'>canvas_y2</span><span class='comma token'>,</span> <span class='canvas_y1 identifier id'>canvas_y1</span> <span class='if if_mod kw'>if</span> <span class='canvas_y1 identifier id'>canvas_y1</span> <span class='gt op'>&gt;</span> <span class='canvas_y2 identifier id'>canvas_y2</span>
          <span class='width identifier id'>width</span>     <span class='assign token'>=</span> <span class='canvas_x2 identifier id'>canvas_x2</span> <span class='minus op'>-</span> <span class='canvas_x1 identifier id'>canvas_x1</span>
          <span class='height identifier id'>height</span>    <span class='assign token'>=</span> <span class='canvas_y2 identifier id'>canvas_y2</span> <span class='minus op'>-</span> <span class='canvas_y1 identifier id'>canvas_y1</span>
          <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='crop identifier id'>crop</span><span class='lparen token'>(</span><span class='canvas_x1 identifier id'>canvas_x1</span><span class='comma token'>,</span> <span class='canvas_y1 identifier id'>canvas_y1</span><span class='comma token'>,</span> <span class='width identifier id'>width</span><span class='comma token'>,</span> <span class='height identifier id'>height</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Applies the mask on the {Canvas}.</span>
      <span class='comment val'>#</span>
      <span class='comment val'># Composes the alpha channel from the &lt;tt&gt;mask&lt;/tt&gt; image with the</span>
      <span class='comment val'># one from the canvas and return the original canvas with the</span>
      <span class='comment val'># alpha-channel modified. Any opaque pixels from the &lt;tt&gt;mask&lt;/tt&gt; are</span>
      <span class='comment val'># converted to grayscale using BT709 luminosity factors, i.e. black is</span>
      <span class='comment val'># fully transparent and white is fully opaque.</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @param [Integer] x The left coordinate of the mask operation.</span>
      <span class='comment val'># @param [Integer] y The top coordinate of the mask operation.</span>
      <span class='comment val'># @return {Command} A command which applies the mask on the canvas.</span>
      <span class='def def kw'>def</span> <span class='magick_mask identifier id'>magick_mask</span><span class='lparen token'>(</span><span class='mask identifier id'>mask</span><span class='comma token'>,</span> <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='assert_type identifier id'>assert_type</span> <span class='string val'>'mask'</span><span class='comma token'>,</span> <span class='mask identifier id'>mask</span><span class='comma token'>,</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Canvas constant id'>Canvas</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='assert_type identifier id'>assert_type</span> <span class='string val'>'x'</span><span class='comma token'>,</span>    <span class='x identifier id'>x</span><span class='comma token'>,</span>    <span class='Sass constant id'>Sass</span><span class='colon2 op'>::</span><span class='Script constant id'>Script</span><span class='colon2 op'>::</span><span class='Number constant id'>Number</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='assert_type identifier id'>assert_type</span> <span class='string val'>'y'</span><span class='comma token'>,</span>    <span class='y identifier id'>y</span><span class='comma token'>,</span>    <span class='Sass constant id'>Sass</span><span class='colon2 op'>::</span><span class='Script constant id'>Script</span><span class='colon2 op'>::</span><span class='Number constant id'>Number</span>
        <span class='Command constant id'>Command</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='canvas identifier id'>canvas</span><span class='bitor op'>|</span>
          <span class='canvas_x identifier id'>canvas_x</span> <span class='assign token'>=</span> <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='value_of identifier id'>value_of</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span>  <span class='minus op'>-</span> <span class='integer val'>1</span><span class='comma token'>,</span>  <span class='integer val'>0</span><span class='rparen token'>)</span>
          <span class='canvas_y identifier id'>canvas_y</span> <span class='assign token'>=</span> <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='value_of identifier id'>value_of</span><span class='lparen token'>(</span><span class='y identifier id'>y</span><span class='comma token'>,</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
          <span class='raise identifier id'>raise</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='OutOfBounds constant id'>OutOfBounds</span><span class='comma token'>,</span> <span class='string val'>'Canvas image width is too small to fit mask'</span>  <span class='if if_mod kw'>if</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span>  <span class='lt op'>&lt;</span> <span class='mask identifier id'>mask</span><span class='dot token'>.</span><span class='width identifier id'>width</span>  <span class='plus op'>+</span> <span class='canvas_x identifier id'>canvas_x</span>
          <span class='raise identifier id'>raise</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='OutOfBounds constant id'>OutOfBounds</span><span class='comma token'>,</span> <span class='string val'>'Canvas image height is too small to fit mask'</span> <span class='if if_mod kw'>if</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='lt op'>&lt;</span> <span class='mask identifier id'>mask</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='plus op'>+</span> <span class='canvas_y identifier id'>canvas_y</span>
          <span class='for for kw'>for</span> <span class='y identifier id'>y</span> <span class='in in kw'>in</span> <span class='integer val'>0</span><span class='dot3 op'>...</span><span class='mask identifier id'>mask</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='do do kw'>do</span>
            <span class='for for kw'>for</span> <span class='x identifier id'>x</span> <span class='in in kw'>in</span> <span class='integer val'>0</span><span class='dot3 op'>...</span><span class='mask identifier id'>mask</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='do do kw'>do</span>
              <span class='canvas_pixel identifier id'>canvas_pixel</span> <span class='assign token'>=</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='get_pixel identifier id'>get_pixel</span><span class='lparen token'>(</span><span class='x identifier id'>x</span> <span class='plus op'>+</span> <span class='canvas_x identifier id'>canvas_x</span><span class='comma token'>,</span> <span class='y identifier id'>y</span> <span class='plus op'>+</span> <span class='canvas_y identifier id'>canvas_y</span><span class='rparen token'>)</span>
              <span class='mask_pixel identifier id'>mask_pixel</span>   <span class='assign token'>=</span> <span class='mask identifier id'>mask</span><span class='dot token'>.</span><span class='get_pixel identifier id'>get_pixel</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='y identifier id'>y</span><span class='rparen token'>)</span>
              <span class='mask_alpha identifier id'>mask_alpha</span>   <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='r identifier id'>r</span><span class='lparen token'>(</span><span class='mask_pixel identifier id'>mask_pixel</span><span class='rparen token'>)</span> <span class='mult op'>*</span> <span class='integer val'>0</span><span class='integer val'>.2125</span> <span class='plus op'>+</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='g identifier id'>g</span><span class='lparen token'>(</span><span class='mask_pixel identifier id'>mask_pixel</span><span class='rparen token'>)</span> <span class='mult op'>*</span> <span class='integer val'>0</span><span class='integer val'>.7154</span> <span class='plus op'>+</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='b identifier id'>b</span><span class='lparen token'>(</span><span class='mask_pixel identifier id'>mask_pixel</span><span class='rparen token'>)</span> <span class='mult op'>*</span> <span class='integer val'>0</span><span class='integer val'>.0721</span><span class='rparen token'>)</span> <span class='mult op'>*</span> <span class='lparen token'>(</span><span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='a identifier id'>a</span><span class='lparen token'>(</span><span class='mask_pixel identifier id'>mask_pixel</span><span class='rparen token'>)</span> <span class='div op'>/</span> <span class='float val'>255.0</span><span class='rparen token'>)</span>
              <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='set_pixel identifier id'>set_pixel</span><span class='lparen token'>(</span><span class='x identifier id'>x</span> <span class='plus op'>+</span> <span class='canvas_x identifier id'>canvas_x</span><span class='comma token'>,</span> <span class='y identifier id'>y</span> <span class='plus op'>+</span> <span class='canvas_y identifier id'>canvas_y</span><span class='comma token'>,</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='rgba identifier id'>rgba</span><span class='lparen token'>(</span>
                <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='r identifier id'>r</span><span class='lparen token'>(</span><span class='canvas_pixel identifier id'>canvas_pixel</span><span class='rparen token'>)</span><span class='comma token'>,</span>
                <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='g identifier id'>g</span><span class='lparen token'>(</span><span class='canvas_pixel identifier id'>canvas_pixel</span><span class='rparen token'>)</span><span class='comma token'>,</span>
                <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='b identifier id'>b</span><span class='lparen token'>(</span><span class='canvas_pixel identifier id'>canvas_pixel</span><span class='rparen token'>)</span><span class='comma token'>,</span>
                <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='a identifier id'>a</span><span class='lparen token'>(</span><span class='canvas_pixel identifier id'>canvas_pixel</span><span class='rparen token'>)</span> <span class='mult op'>*</span> <span class='lparen token'>(</span><span class='mask_alpha identifier id'>mask_alpha</span> <span class='div op'>/</span> <span class='float val'>255.0</span><span class='rparen token'>)</span>
              <span class='rparen token'>)</span><span class='rparen token'>)</span>
            <span class='end end kw'>end</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Apply an effect on the {Canvas}.</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @param [Sass::Script::String] name The name of the effect to apply.</span>
      <span class='comment val'># @param [Array] args The arguments to pass to the effect.</span>
      <span class='comment val'># @return {Effect} A command which applies the effect to the canvas.</span>
      <span class='def def kw'>def</span> <span class='magick_effect identifier id'>magick_effect</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='assert_type identifier id'>assert_type</span> <span class='string val'>'name'</span><span class='comma token'>,</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='Sass constant id'>Sass</span><span class='colon2 op'>::</span><span class='Script constant id'>Script</span><span class='colon2 op'>::</span><span class='String constant id'>String</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Functions constant id'>Functions</span><span class='colon2 op'>::</span><span class='Operations constant id'>Operations</span><span class='colon2 op'>::</span><span class='Effects constant id'>Effects</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Apply drop shadow on the {Canvas}.</span>
      <span class='comment val'>#</span>
      <span class='comment val'># The alpha channel is used to construct a mask of the original image</span>
      <span class='comment val'># which is then used as a base for the horizontal/vertical shadow pass.</span>
      <span class='comment val'>#</span>
      <span class='comment val'># Copyright (c) 2005 by Romain Guy</span>
      <span class='comment val'># http://www.curious-creature.org/2005/07/06/non-rectangular-shadow/</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @param [Sass::Script::Number] angle The angle of the shadow.</span>
      <span class='comment val'># @param [Sass::Script::Number] distance The distance of the shadow from</span>
      <span class='comment val'>#   the original canvas.</span>
      <span class='comment val'># @param [Sass::Script::Number] size The size (blur) of the shadow.</span>
      <span class='comment val'># @param [Sass::Script::Color] color The color of the shadow.</span>
      <span class='comment val'># @return {Command} A command which applies the drop shadow to the</span>
      <span class='comment val'>#   canvas.</span>
      <span class='def def kw'>def</span> <span class='magick_drop_shadow identifier id'>magick_drop_shadow</span><span class='lparen token'>(</span><span class='angle identifier id'>angle</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='distance identifier id'>distance</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='size identifier id'>size</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='color identifier id'>color</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='assert_type identifier id'>assert_type</span> <span class='string val'>'angle'</span><span class='comma token'>,</span>    <span class='angle identifier id'>angle</span><span class='comma token'>,</span>    <span class='Sass constant id'>Sass</span><span class='colon2 op'>::</span><span class='Script constant id'>Script</span><span class='colon2 op'>::</span><span class='Number constant id'>Number</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='assert_type identifier id'>assert_type</span> <span class='string val'>'distance'</span><span class='comma token'>,</span> <span class='distance identifier id'>distance</span><span class='comma token'>,</span> <span class='Sass constant id'>Sass</span><span class='colon2 op'>::</span><span class='Script constant id'>Script</span><span class='colon2 op'>::</span><span class='Number constant id'>Number</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='assert_type identifier id'>assert_type</span> <span class='string val'>'size'</span><span class='comma token'>,</span>     <span class='size identifier id'>size</span><span class='comma token'>,</span>     <span class='Sass constant id'>Sass</span><span class='colon2 op'>::</span><span class='Script constant id'>Script</span><span class='colon2 op'>::</span><span class='Number constant id'>Number</span>
        <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='assert_type identifier id'>assert_type</span> <span class='string val'>'color'</span><span class='comma token'>,</span>    <span class='color identifier id'>color</span><span class='comma token'>,</span>    <span class='Sass constant id'>Sass</span><span class='colon2 op'>::</span><span class='Script constant id'>Script</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span>
        <span class='Command constant id'>Command</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='canvas identifier id'>canvas</span><span class='bitor op'>|</span>
          <span class='shadow_angle identifier id'>shadow_angle</span>    <span class='assign token'>=</span> <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='value_of identifier id'>value_of</span><span class='lparen token'>(</span><span class='angle identifier id'>angle</span><span class='comma token'>,</span>    <span class='integer val'>360</span><span class='comma token'>,</span>                               <span class='integer val'>0</span><span class='rparen token'>)</span>
          <span class='shadow_distance identifier id'>shadow_distance</span> <span class='assign token'>=</span> <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='value_of identifier id'>value_of</span><span class='lparen token'>(</span><span class='distance identifier id'>distance</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='comma token'>,</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='height identifier id'>height</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='min identifier id'>min</span><span class='comma token'>,</span> <span class='integer val'>5</span><span class='rparen token'>)</span>
          <span class='shadow_size identifier id'>shadow_size</span>     <span class='assign token'>=</span> <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='value_of identifier id'>value_of</span><span class='lparen token'>(</span><span class='size identifier id'>size</span><span class='comma token'>,</span>     <span class='lbrack token'>[</span><span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='comma token'>,</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='height identifier id'>height</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='min identifier id'>min</span><span class='comma token'>,</span> <span class='integer val'>5</span><span class='rparen token'>)</span>
          <span class='shadow_color identifier id'>shadow_color</span>    <span class='assign token'>=</span> <span class='Compass constant id'>Compass</span><span class='colon2 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Utils constant id'>Utils</span><span class='dot token'>.</span><span class='to_chunky_color identifier id'>to_chunky_color</span><span class='lparen token'>(</span><span class='color identifier id'>color</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='integer val'>? </span><span class='Sass constant id'>Sass</span><span class='colon2 op'>::</span><span class='Script constant id'>Script</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='color identifier id'>color</span><span class='rparen token'>)</span>
          <span class='shadow_canvas identifier id'>shadow_canvas</span>   <span class='assign token'>=</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Canvas constant id'>Canvas</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='plus op'>+</span> <span class='shadow_size identifier id'>shadow_size</span> <span class='mult op'>*</span> <span class='integer val'>2</span><span class='comma token'>,</span> <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='plus op'>+</span> <span class='shadow_size identifier id'>shadow_size</span> <span class='mult op'>*</span> <span class='integer val'>2</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='replace identifier id'>replace</span><span class='lparen token'>(</span><span class='canvas identifier id'>canvas</span><span class='comma token'>,</span> <span class='shadow_size identifier id'>shadow_size</span><span class='comma token'>,</span> <span class='shadow_size identifier id'>shadow_size</span><span class='rparen token'>)</span>
          <span class='shadow_pixels identifier id'>shadow_pixels</span>   <span class='assign token'>=</span> <span class='shadow_canvas identifier id'>shadow_canvas</span><span class='dot token'>.</span><span class='pixels identifier id'>pixels</span>
          <span class='shadow_red identifier id'>shadow_red</span>      <span class='assign token'>=</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='r identifier id'>r</span><span class='lparen token'>(</span><span class='shadow_color identifier id'>shadow_color</span><span class='rparen token'>)</span>
          <span class='shadow_green identifier id'>shadow_green</span>    <span class='assign token'>=</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='g identifier id'>g</span><span class='lparen token'>(</span><span class='shadow_color identifier id'>shadow_color</span><span class='rparen token'>)</span>
          <span class='shadow_blue identifier id'>shadow_blue</span>     <span class='assign token'>=</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='b identifier id'>b</span><span class='lparen token'>(</span><span class='shadow_color identifier id'>shadow_color</span><span class='rparen token'>)</span>
          <span class='shadow_alpha identifier id'>shadow_alpha</span>    <span class='assign token'>=</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='a identifier id'>a</span><span class='lparen token'>(</span><span class='shadow_color identifier id'>shadow_color</span><span class='rparen token'>)</span>
          <span class='angle_radians identifier id'>angle_radians</span>   <span class='assign token'>=</span> <span class='shadow_angle identifier id'>shadow_angle</span> <span class='mult op'>*</span> <span class='Math constant id'>Math</span><span class='colon2 op'>::</span><span class='PI constant id'>PI</span> <span class='div op'>/</span> <span class='integer val'>180</span>
          <span class='distance_x identifier id'>distance_x</span>      <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='Math constant id'>Math</span><span class='dot token'>.</span><span class='cos identifier id'>cos</span><span class='lparen token'>(</span><span class='angle_radians identifier id'>angle_radians</span><span class='rparen token'>)</span> <span class='mult op'>*</span> <span class='shadow_distance identifier id'>shadow_distance</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
          <span class='distance_y identifier id'>distance_y</span>      <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='Math constant id'>Math</span><span class='dot token'>.</span><span class='sin identifier id'>sin</span><span class='lparen token'>(</span><span class='angle_radians identifier id'>angle_radians</span><span class='rparen token'>)</span> <span class='mult op'>*</span> <span class='shadow_distance identifier id'>shadow_distance</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
          <span class='left identifier id'>left</span>            <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='shadow_size identifier id'>shadow_size</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='rparen token'>)</span> <span class='rshft op'>&gt;&gt;</span> <span class='integer val'>1</span>
          <span class='right identifier id'>right</span>           <span class='assign token'>=</span> <span class='shadow_size identifier id'>shadow_size</span> <span class='minus op'>-</span> <span class='left identifier id'>left</span>
          <span class='x_start identifier id'>x_start</span>         <span class='assign token'>=</span> <span class='left identifier id'>left</span>
          <span class='x_finish identifier id'>x_finish</span>        <span class='assign token'>=</span> <span class='shadow_canvas identifier id'>shadow_canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='minus op'>-</span> <span class='right identifier id'>right</span>
          <span class='y_start identifier id'>y_start</span>         <span class='assign token'>=</span> <span class='left identifier id'>left</span>
          <span class='y_finish identifier id'>y_finish</span>        <span class='assign token'>=</span> <span class='shadow_canvas identifier id'>shadow_canvas</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='minus op'>-</span> <span class='right identifier id'>right</span>
          <span class='a_history identifier id'>a_history</span>       <span class='assign token'>=</span> <span class='Array constant id'>Array</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='shadow_size identifier id'>shadow_size</span><span class='rparen token'>)</span>
          <span class='history_index identifier id'>history_index</span>   <span class='assign token'>=</span> <span class='integer val'>0</span>
          <span class='sum_divider identifier id'>sum_divider</span>     <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='shadow_alpha identifier id'>shadow_alpha</span> <span class='div op'>/</span> <span class='float val'>255.0</span><span class='rparen token'>)</span> <span class='div op'>/</span> <span class='shadow_size identifier id'>shadow_size</span>
          <span class='buffer_offset identifier id'>buffer_offset</span>   <span class='assign token'>=</span> <span class='integer val'>0</span>
          <span class='last_pixel_offset identifier id'>last_pixel_offset</span> <span class='assign token'>=</span> <span class='right identifier id'>right</span> <span class='mult op'>*</span> <span class='shadow_canvas identifier id'>shadow_canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span>
          <span class='for for kw'>for</span> <span class='y identifier id'>y</span> <span class='in in kw'>in</span> <span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='shadow_canvas identifier id'>shadow_canvas</span><span class='dot token'>.</span><span class='height identifier id'>height</span><span class='rparen token'>)</span>
            <span class='a_sum identifier id'>a_sum</span>         <span class='assign token'>=</span> <span class='integer val'>0</span>
            <span class='history_index identifier id'>history_index</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
            <span class='for for kw'>for</span> <span class='x identifier id'>x</span> <span class='in in kw'>in</span> <span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='shadow_size identifier id'>shadow_size</span><span class='rparen token'>)</span>
              <span class='a identifier id'>a</span> <span class='assign token'>=</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='a identifier id'>a</span><span class='lparen token'>(</span><span class='shadow_pixels identifier id'>shadow_pixels</span><span class='lbrack token'>[</span><span class='buffer_offset identifier id'>buffer_offset</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
              <span class='a_history identifier id'>a_history</span><span class='lbrack token'>[</span><span class='x identifier id'>x</span><span class='rbrack token'>]</span>  <span class='assign token'>=</span> <span class='a identifier id'>a</span>
              <span class='a_sum identifier id'>a_sum</span>         <span class='assign token'>=</span> <span class='a_sum identifier id'>a_sum</span> <span class='plus op'>+</span> <span class='a identifier id'>a</span>
              <span class='buffer_offset identifier id'>buffer_offset</span> <span class='assign token'>=</span> <span class='buffer_offset identifier id'>buffer_offset</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
            <span class='end end kw'>end</span>
            <span class='buffer_offset identifier id'>buffer_offset</span> <span class='assign token'>=</span> <span class='buffer_offset identifier id'>buffer_offset</span> <span class='minus op'>-</span> <span class='right identifier id'>right</span>
            <span class='for for kw'>for</span> <span class='x identifier id'>x</span> <span class='in in kw'>in</span> <span class='lparen token'>(</span><span class='x_start identifier id'>x_start</span><span class='dot3 op'>...</span><span class='x_finish identifier id'>x_finish</span><span class='rparen token'>)</span>
              <span class='a identifier id'>a</span> <span class='assign token'>=</span> <span class='a_sum identifier id'>a_sum</span> <span class='mult op'>*</span> <span class='sum_divider identifier id'>sum_divider</span>
              <span class='shadow_pixels identifier id'>shadow_pixels</span><span class='lbrack token'>[</span><span class='buffer_offset identifier id'>buffer_offset</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='rgba identifier id'>rgba</span><span class='lparen token'>(</span><span class='shadow_red identifier id'>shadow_red</span><span class='comma token'>,</span> <span class='shadow_green identifier id'>shadow_green</span><span class='comma token'>,</span> <span class='shadow_blue identifier id'>shadow_blue</span><span class='comma token'>,</span> <span class='lparen token'>(</span><span class='shadow_alpha identifier id'>shadow_alpha</span> <span class='mult op'>*</span> <span class='lparen token'>(</span><span class='a identifier id'>a</span> <span class='div op'>/</span> <span class='float val'>255.0</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span>
              <span class='a_sum identifier id'>a_sum</span> <span class='assign token'>=</span> <span class='a_sum identifier id'>a_sum</span> <span class='minus op'>-</span> <span class='a_history identifier id'>a_history</span><span class='lbrack token'>[</span><span class='history_index identifier id'>history_index</span><span class='rbrack token'>]</span>
              <span class='a identifier id'>a</span> <span class='assign token'>=</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='a identifier id'>a</span><span class='lparen token'>(</span><span class='shadow_pixels identifier id'>shadow_pixels</span><span class='lbrack token'>[</span><span class='buffer_offset identifier id'>buffer_offset</span> <span class='plus op'>+</span> <span class='right identifier id'>right</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
              <span class='a_history identifier id'>a_history</span><span class='lbrack token'>[</span><span class='history_index identifier id'>history_index</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='a identifier id'>a</span>
              <span class='a_sum identifier id'>a_sum</span> <span class='assign token'>=</span> <span class='a_sum identifier id'>a_sum</span> <span class='plus op'>+</span> <span class='a identifier id'>a</span>
              <span class='history_index identifier id'>history_index</span> <span class='assign token'>=</span> <span class='history_index identifier id'>history_index</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
              <span class='history_index identifier id'>history_index</span> <span class='assign token'>=</span> <span class='history_index identifier id'>history_index</span> <span class='minus op'>-</span> <span class='shadow_size identifier id'>shadow_size</span> <span class='if if_mod kw'>if</span> <span class='history_index identifier id'>history_index</span> <span class='geq op'>&gt;=</span> <span class='shadow_size identifier id'>shadow_size</span>
              <span class='buffer_offset identifier id'>buffer_offset</span> <span class='assign token'>=</span> <span class='buffer_offset identifier id'>buffer_offset</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
            <span class='end end kw'>end</span>
            <span class='buffer_offset identifier id'>buffer_offset</span> <span class='assign token'>=</span> <span class='y identifier id'>y</span> <span class='mult op'>*</span> <span class='shadow_canvas identifier id'>shadow_canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span>
          <span class='end end kw'>end</span>
          <span class='buffer_offset identifier id'>buffer_offset</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
          <span class='for for kw'>for</span> <span class='x identifier id'>x</span> <span class='in in kw'>in</span> <span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='shadow_canvas identifier id'>shadow_canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='rparen token'>)</span>
            <span class='a_sum identifier id'>a_sum</span>         <span class='assign token'>=</span> <span class='integer val'>0</span>
            <span class='history_index identifier id'>history_index</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
            <span class='for for kw'>for</span> <span class='y identifier id'>y</span> <span class='in in kw'>in</span> <span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='shadow_size identifier id'>shadow_size</span><span class='rparen token'>)</span>
              <span class='a identifier id'>a</span> <span class='assign token'>=</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='a identifier id'>a</span><span class='lparen token'>(</span><span class='shadow_pixels identifier id'>shadow_pixels</span><span class='lbrack token'>[</span><span class='buffer_offset identifier id'>buffer_offset</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
              <span class='a_history identifier id'>a_history</span><span class='lbrack token'>[</span><span class='y identifier id'>y</span><span class='rbrack token'>]</span>  <span class='assign token'>=</span> <span class='a identifier id'>a</span>
              <span class='a_sum identifier id'>a_sum</span>         <span class='assign token'>=</span> <span class='a_sum identifier id'>a_sum</span> <span class='plus op'>+</span> <span class='a identifier id'>a</span>
              <span class='buffer_offset identifier id'>buffer_offset</span> <span class='assign token'>=</span> <span class='buffer_offset identifier id'>buffer_offset</span> <span class='plus op'>+</span> <span class='shadow_canvas identifier id'>shadow_canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span>
            <span class='end end kw'>end</span>
            <span class='buffer_offset identifier id'>buffer_offset</span> <span class='assign token'>=</span> <span class='buffer_offset identifier id'>buffer_offset</span> <span class='minus op'>-</span> <span class='last_pixel_offset identifier id'>last_pixel_offset</span>
            <span class='for for kw'>for</span> <span class='y identifier id'>y</span> <span class='in in kw'>in</span> <span class='lparen token'>(</span><span class='y_start identifier id'>y_start</span><span class='dot3 op'>...</span><span class='y_finish identifier id'>y_finish</span><span class='rparen token'>)</span>
              <span class='a identifier id'>a</span> <span class='assign token'>=</span> <span class='a_sum identifier id'>a_sum</span> <span class='mult op'>*</span> <span class='sum_divider identifier id'>sum_divider</span>
              <span class='shadow_pixels identifier id'>shadow_pixels</span><span class='lbrack token'>[</span><span class='buffer_offset identifier id'>buffer_offset</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='rgba identifier id'>rgba</span><span class='lparen token'>(</span><span class='shadow_red identifier id'>shadow_red</span><span class='comma token'>,</span> <span class='shadow_green identifier id'>shadow_green</span><span class='comma token'>,</span> <span class='shadow_blue identifier id'>shadow_blue</span><span class='comma token'>,</span> <span class='lparen token'>(</span><span class='shadow_alpha identifier id'>shadow_alpha</span> <span class='mult op'>*</span> <span class='lparen token'>(</span><span class='a identifier id'>a</span> <span class='div op'>/</span> <span class='float val'>255.0</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span>
              <span class='a_sum identifier id'>a_sum</span> <span class='assign token'>=</span> <span class='a_sum identifier id'>a_sum</span> <span class='minus op'>-</span> <span class='a_history identifier id'>a_history</span><span class='lbrack token'>[</span><span class='history_index identifier id'>history_index</span><span class='rbrack token'>]</span>
              <span class='a identifier id'>a</span> <span class='assign token'>=</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='a identifier id'>a</span><span class='lparen token'>(</span><span class='shadow_pixels identifier id'>shadow_pixels</span><span class='lbrack token'>[</span><span class='buffer_offset identifier id'>buffer_offset</span> <span class='plus op'>+</span> <span class='last_pixel_offset identifier id'>last_pixel_offset</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
              <span class='a_history identifier id'>a_history</span><span class='lbrack token'>[</span><span class='history_index identifier id'>history_index</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='a identifier id'>a</span>
              <span class='a_sum identifier id'>a_sum</span> <span class='assign token'>=</span> <span class='a_sum identifier id'>a_sum</span> <span class='plus op'>+</span> <span class='a identifier id'>a</span>
              <span class='history_index identifier id'>history_index</span> <span class='assign token'>=</span> <span class='history_index identifier id'>history_index</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
              <span class='history_index identifier id'>history_index</span> <span class='assign token'>=</span> <span class='history_index identifier id'>history_index</span> <span class='minus op'>-</span> <span class='shadow_size identifier id'>shadow_size</span> <span class='if if_mod kw'>if</span> <span class='history_index identifier id'>history_index</span> <span class='geq op'>&gt;=</span> <span class='shadow_size identifier id'>shadow_size</span>
              <span class='buffer_offset identifier id'>buffer_offset</span> <span class='assign token'>=</span> <span class='buffer_offset identifier id'>buffer_offset</span> <span class='plus op'>+</span> <span class='shadow_canvas identifier id'>shadow_canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span>
            <span class='end end kw'>end</span>
            <span class='buffer_offset identifier id'>buffer_offset</span> <span class='assign token'>=</span> <span class='x identifier id'>x</span>
          <span class='end end kw'>end</span>
          <span class='for for kw'>for</span> <span class='y identifier id'>y</span> <span class='in in kw'>in</span> <span class='integer val'>0</span><span class='dot3 op'>...</span><span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='do do kw'>do</span>
            <span class='for for kw'>for</span> <span class='x identifier id'>x</span> <span class='in in kw'>in</span> <span class='integer val'>0</span><span class='dot3 op'>...</span><span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='do do kw'>do</span>
              <span class='shadow_x identifier id'>shadow_x</span> <span class='assign token'>=</span> <span class='x identifier id'>x</span> <span class='plus op'>+</span> <span class='shadow_size identifier id'>shadow_size</span> <span class='plus op'>+</span> <span class='distance_x identifier id'>distance_x</span>
              <span class='shadow_y identifier id'>shadow_y</span> <span class='assign token'>=</span> <span class='y identifier id'>y</span> <span class='plus op'>+</span> <span class='shadow_size identifier id'>shadow_size</span> <span class='plus op'>+</span> <span class='distance_y identifier id'>distance_y</span>
              <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='set_pixel identifier id'>set_pixel</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='y identifier id'>y</span><span class='comma token'>,</span> <span class='ChunkyPNG constant id'>ChunkyPNG</span><span class='colon2 op'>::</span><span class='Color constant id'>Color</span><span class='dot token'>.</span><span class='compose_precise identifier id'>compose_precise</span><span class='lparen token'>(</span>
                <span class='canvas identifier id'>canvas</span><span class='dot token'>.</span><span class='get_pixel identifier id'>get_pixel</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='y identifier id'>y</span><span class='rparen token'>)</span><span class='comma token'>,</span>
                <span class='shadow_pixels identifier id'>shadow_pixels</span><span class='lbrack token'>[</span><span class='shadow_y identifier id'>shadow_y</span> <span class='mult op'>*</span> <span class='shadow_canvas identifier id'>shadow_canvas</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='plus op'>+</span> <span class='shadow_x identifier id'>shadow_x</span><span class='rbrack token'>]</span>
              <span class='rparen token'>)</span><span class='rparen token'>)</span>
            <span class='end end kw'>end</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Sun Apr  3 15:40:26 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.4 (ruby-1.8.7).
</div>

  </body>
</html>